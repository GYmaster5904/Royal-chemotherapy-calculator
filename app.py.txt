import streamlit as st

# 1. í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="Royal Vet Oncology Center", layout="wide")

# 2. ë””ìì¸ (ë¸”ë™ í…Œë§ˆ & ë„¤ì˜¨ ê·¸ë¦°)
st.markdown("""
    <style>
    .stApp { background-color: #000000; color: #ffffff; }
    [data-testid="stSidebar"] { background-color: #111111; border-right: 1px solid #333; }
    .stSelectbox, .stNumberInput, .stSlider { background-color: #1e1e1e !important; color: #ffffff !important; }
    .result-card {
        background-color: #151515;
        padding: 25px;
        border-radius: 15px;
        border: 2px solid #00FFC8;
        box-shadow: 0 0 15px rgba(0, 255, 200, 0.2);
        margin-bottom: 20px;
    }
    h1, h2, h3 { color: #00FFC8 !important; }
    .label-text { color: #888888; font-size: 14px; margin-bottom: 5px; }
    .value-text { color: #ffffff; font-size: 32px; font-weight: bold; }
    </style>
    """, unsafe_allow_all_html=True)

# 3. ì•½ì „ ë°ì´í„°ë² ì´ìŠ¤
DRUGS = {
    "ë¡œì´ë‚˜ì œì£¼ (L-Asparaginase)": {"conc": 2000, "dose": 400, "unit": "IU/kg", "label": "IU", "vial": "10,000 IU/Vial", "diluent": "0.9% NaCl (5ml í¬ì„ ì‹œ 2000IU/ml)", "protocol": "ì „ì²˜ì¹˜: Diphen(IM). SC/IM ê¶Œì¥. ì·Œì¥ì—¼ ì£¼ì˜."},
    "ë²¨ë°”ìŠ¤í‹´ì£¼ (Vinblastine)": {"conc": 1.0, "dose": 2.0, "unit": "mg/m2", "label": "mg", "vial": "10mg/Vial", "diluent": "0.9% NaCl", "protocol": "IV Bolus. Vesicant ì£¼ì˜. Vincristineë³´ë‹¤ ê³¨ìˆ˜ë…ì„± ê°•í•¨."},
    "ë¹ˆí¬ë€ì£¼ (Vincristine)": {"conc": 1.0, "dose": 0.7, "unit": "mg/m2", "label": "mg", "vial": "1mg/Vial", "diluent": "0.9% NaCl", "protocol": "IV Bolus. Vesicant. ì‹ ê²½ë…ì„±(ì¥ë§ˆë¹„) ëª¨ë‹ˆí„°ë§."},
    "ì•„ë“œë¦¬ì•„ë§ˆì´ì‹  (Doxorubicin)": {"conc": 2.0, "dose": 30.0, "unit": "mg/m2", "label": "mg", "vial": "10mg/5ml", "diluent": "0.9% NaCl", "protocol": "ì „ì²˜ì¹˜: Diphen+Dexa. 20ë¶„ ì €ì† IV. ì‹¬ë…ì„± ì£¼ì˜."},
    "ì¹´ë³´í‹°ë†€ì£¼ (Carboplatin)": {"conc": 10.0, "dose": 300.0, "unit": "mg/m2", "label": "mg", "vial": "150mg/15ml", "diluent": "5% Dextrose (D5W) í•„ìˆ˜", "protocol": "D5W ì „ìš©. NaCl í˜¼í•© ì ˆëŒ€ ê¸ˆì§€. ì‹ ì¥ìˆ˜ì¹˜ í™•ì¸."},
    "ì‹œíƒ€ë¼ë¹ˆì£¼ (Cytarabine)": {"conc": 20.0, "dose": 100.0, "unit": "mg/m2", "label": "mg", "vial": "100mg/5ml", "diluent": "0.9% NaCl ë˜ëŠ” D5W", "protocol": "SC ë˜ëŠ” CRI íˆ¬ì—¬. ê³¨ìˆ˜ì–µì œ ì£¼ì˜."},
    "ì—”ë…ì‚°ì£¼ (Cyclophosphamide)": {"conc": 20.0, "dose": 250.0, "unit": "mg/m2", "label": "mg", "vial": "500mg/Vial", "diluent": "0.9% NaCl", "protocol": "ì „ì²˜ì¹˜: Furosemide ê¶Œì¥. ë°©ê´‘ì—¼ ì£¼ì˜. ì¶©ë¶„í•œ ìŒìˆ˜ ìœ ë„."},
    "ë¯¸íŠ¸ë¡ ì£¼ (Mitoxantrone)": {"conc": 2.0, "dose": 5.5, "unit": "mg/m2", "label": "mg", "vial": "20mg/10ml", "diluent": "0.9% NaCl", "protocol": "15ë¶„ IV. ì†Œë³€ìƒ‰ ë³€í™”(ì²­ë¡ìƒ‰) ê°€ëŠ¥ì„± ê³ ì§€."},
    "ì¹´ë””ì˜¥ì‚°ì£¼ (Dexrazoxane)": {"conc": 10.0, "dose": 10.0, "unit": "ratio (10:1)", "label": "mg", "vial": "500mg/Vial", "diluent": "0.9% NaCl", "protocol": "ëª©ì : Dox ì‹¬ë…ì„± ì˜ˆë°©. Dox íˆ¬ì—¬ ì „ ì£¼ì…. Dox mgì˜ 10ë°° ìš©ëŸ‰."},
    "ë°•ìŠ¤ë£¨í‚¨15ì£¼ (IL-2)": {"conc": 100.0, "dose": 100.0, "unit": "Î¼g/head", "label": "Î¼g", "vial": "100Î¼g/1ml", "diluent": "0.9% NaCl", "protocol": "ë©´ì—­ìš”ë²•ì œ. ë°œì—´ ë“± ë©´ì—­ ë°˜ì‘ ëª¨ë‹ˆí„°ë§."}
}

# 4. ì‚¬ì´ë“œë°” - í™˜ì ì •ë³´
st.sidebar.title("ğŸ¾ í™˜ì ì •ë³´")
breed = st.sidebar.radio("ì¢… ì„ íƒ", ["Dog", "Cat"])
weight = st.sidebar.number_input("ì²´ì¤‘ (kg)", min_value=0.1, value=10.0, step=0.1)

k = 10.1 if breed == "Dog" else 10.0
bsa = (k * (weight ** (2/3))) / 100
st.sidebar.markdown(f"### BSA: **{bsa:.4f} mÂ²**")

# 5. ë©”ì¸ í™”ë©´
st.title("ğŸ©º Veterinary Chemo Dose Calculator")

drug_name = st.selectbox("í•­ì•”ì œ ì„ íƒ", list(DRUGS.keys()))
drug = DRUGS[drug_name]

col1, col2 = st.columns(2)
with col1:
    basis = st.radio("ê³„ì‚° ê¸°ì¤€", ["BSA(m2) ê¸°ì¤€", "ì²´ì¤‘(kg) ê¸°ì¤€"], 
                    index=0 if "m2" in drug["unit"] else 1)
    target = st.number_input(f"ì„¤ì • ìš©ëŸ‰ ({drug['unit']})", value=float(drug["dose"]))

with col2:
    reduction = st.select_slider("ìš©ëŸ‰ ì¡°ì • (Reduction %)", options=[50, 60, 70, 80, 90, 100], value=100)

# ê³„ì‚°
if "BSA" in basis:
    total_val = bsa * target * (reduction / 100)
    proc_str = f"{bsa:.4f} mÂ² Ã— {target} Ã— {reduction}%"
else:
    total_val = weight * target * (reduction / 100)
    proc_str = f"{weight} kg Ã— {target} Ã— {reduction}%"

needed_ml = total_val / drug["conc"]

# 6. ê²°ê³¼ ì¶œë ¥
st.markdown("---")
res1, res2 = st.columns(2)

with res1:
    st.markdown(f"""
    <div class="result-card">
        <div class="label-text">ìµœì¢… í•„ìš” ìš©ëŸ‰</div>
        <div class="value-text" style="color:#00FFC8;">{total_val:.3f} {drug['label']}</div>
        <br>
        <div class="label-text">ì‹¤ì œ ì¡°ì œ ë³¼ë¥¨</div>
        <div class="value-text">{needed_ml:.2f} ml</div>
        <div style="color:#666; font-size:12px; margin-top:10px;">ì‚°ì‹: {proc_str} | ë†ë„: {drug['conc']}{drug['label']}/ml</div>
    </div>
    """, unsafe_allow_all_html=True)

with res2:
    st.subheader("ğŸ“‹ Administration Protocol")
    st.write(f"**í¬ì„ì•¡:** {drug['diluent']}")
    st.info(drug["protocol"])

if breed == "Dog" and weight < 10 and "BSA" in basis:
    st.warning("âš ï¸ Small Dog Warning: 10kg ë¯¸ë§Œ ì†Œí˜•ê²¬ì€ BSA ê¸°ì¤€ ì‹œ ë…ì„± ìœ„í—˜ì´ í½ë‹ˆë‹¤.")

st.caption("Royal Vet Oncology Calculator v2.7 | GUIDED BY AAHA & VCOG-CTCAE v2")